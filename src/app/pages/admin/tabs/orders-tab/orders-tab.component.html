<div class="grid">
    <!-- Orders Summary Cards -->
    <div class="col-12 lg:col-3">
        <p-card styleClass="border-round-xl shadow-3">
            <div class="flex align-items-center justify-content-between">
                <div>
                    <span class="block text-500 font-medium mb-3">Ventas del Mes</span>
                    <div class="text-900 font-bold text-xl">{{ monthlySales | currency:'ARS':'symbol':'1.0-0' }}</div>
                </div>
                <div class="flex align-items-center justify-content-center bg-blue-100 border-round" style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-dollar text-blue-500 text-xl"></i>
                </div>
            </div>
        </p-card>
    </div>
    <div class="col-12 lg:col-3">
        <p-card styleClass="border-round-xl shadow-3">
            <div class="flex align-items-center justify-content-between">
                <div>
                    <span class="block text-500 font-medium mb-3">Pedidos del Mes</span>
                    <div class="text-900 font-bold text-xl">{{ monthlyOrders }}</div>
                </div>
                <div class="flex align-items-center justify-content-center bg-orange-100 border-round" style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-shopping-cart text-orange-500 text-xl"></i>
                </div>
            </div>
        </p-card>
    </div>
    <div class="col-12 lg:col-3">
        <p-card styleClass="border-round-xl shadow-3">
            <div class="flex align-items-center justify-content-between">
                <div>
                    <span class="block text-500 font-medium mb-3">Clientes Nuevos</span>
                    <div class="text-900 font-bold text-xl">{{ newCustomers }}</div>
                </div>
                <div class="flex align-items-center justify-content-center bg-green-100 border-round" style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-users text-green-500 text-xl"></i>
                </div>
            </div>
        </p-card>
    </div>
    <div class="col-12 lg:col-3">
        <p-card styleClass="border-round-xl shadow-3">
            <div class="flex align-items-center justify-content-between">
                <div>
                    <span class="block text-500 font-medium mb-3">Ticket Promedio</span>
                    <div class="text-900 font-bold text-xl">{{ averageTicket | currency:'ARS':'symbol':'1.0-0' }}</div>
                </div>
                <div class="flex align-items-center justify-content-center bg-purple-100 border-round" style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-chart-bar text-purple-500 text-xl"></i>
                </div>
            </div>
        </p-card>
    </div>
</div>

<!-- Orders Management Section -->
<p-card class="border-round-xl shadow-3 p-3">
    <ng-template pTemplate="header">
        <div class="flex justify-content-between align-items-center">
            <h3 class="text-lg font-semibold m-0">
                <i class="pi pi-shopping-cart mr-2"></i>Gestión de Pedidos
            </h3>
            <div class="flex gap-2">
                <p-button label="Exportar Pedidos" icon="pi pi-download" [outlined]="true" (onClick)="exportOrders()" />
                <p-button label="Nuevo Pedido" icon="pi pi-plus" [raised]="true" (onClick)="openOrderDialog()" />
            </div>
        </div>
    </ng-template>

    <p-table [value]="orders" dataKey="id" [paginator]="true" [rows]="10" responsiveLayout="scroll" styleClass="p-datatable-sm">
        <ng-template pTemplate="header">
            <tr>
                <th class="text-left">Pedido</th>
                <th class="text-left">Cliente</th>
                <th class="text-left">Fecha</th>
                <th class="text-left">Productos</th>
                <th class="text-left">Tipo</th>
                <th class="text-left">Subtotal</th>
                <th class="text-left">Envío</th>
                <th class="text-left">Total</th>
                <th class="text-left">Estado</th>
                <th class="text-left">Acciones</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-order>
            <tr>
                <td class="font-semibold text-primary">{{ order.id }}</td>
                <td>
                    <div class="flex flex-column">
                        <span class="font-semibold">{{ order.getCustomerName() }}</span>
                        <span class="text-sm text-600">{{ order.getCustomerEmail() }}</span>
                        <span class="text-sm text-600">{{ order.getCustomerPhone() }}</span>
                    </div>
                </td>
                <td>{{ order.date | date: 'dd/MM/yyyy' }}</td>
                <td>
                    <div class="flex flex-column gap-1">
                        <div *ngFor="let item of order.items" class="flex align-items-center gap-2">
                            <span class="font-semibold">{{ item.getProductName() }}</span>
                            <p-tag [value]="'x' + item.quantity" severity="info" [rounded]="true" size="small"></p-tag>
                            <p-tag *ngIf="item.productSnapshot.variant.color" [value]="item.productSnapshot.variant.color" severity="secondary" [rounded]="true" size="small"
                                icon="pi pi-circle-fill"></p-tag>
                            <p-tag *ngIf="item.productSnapshot.variant.size" [value]="item.productSnapshot.variant.size" severity="contrast" [rounded]="true" size="small"></p-tag>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="flex flex-column gap-1">
                        <div *ngFor="let item of order.items" class="flex align-items-center gap-2">
                            <p-tag *ngIf="isItemPersonalized(item)" value="Personalizado" severity="warn" [rounded]="true" size="small" icon="pi pi-palette"></p-tag>
                            <p-tag *ngIf="!isItemPersonalized(item)" value="Listo" severity="success" [rounded]="true" size="small" icon="pi pi-check-circle"></p-tag>
                        </div>
                    </div>
                </td>
                <td class="font-bold text-blue-600">{{ order.subtotal | currency: 'ARS':'symbol':'1.0-0':'es-AR' }}</td>
                <td>
                    <div class="flex flex-column">
                        <span class="font-semibold text-orange-600">{{ order.shippingPrice | currency: 'ARS':'symbol':'1.0-0':'es-AR' }}</span>
                        <span class="text-sm text-600">{{ order.getShippingAddressSummary() }}</span>
                    </div>
                </td>
                <td class="font-bold text-primary">{{ order.total | currency: 'ARS':'symbol':'1.0-0':'es-AR' }}</td>
                <td>
                    <p-tag [value]="getOrderStatusLabel(order.status)" [severity]="getOrderStatusSeverity(order.status)" [rounded]="true"></p-tag>
                </td>
                <td>
                    <div class="flex gap-2 align-items-center">
                        <p-button icon="pi pi-eye" (onClick)="viewOrder(order)" [rounded]="true" size="small" pTooltip="Ver Detalles" />
                        <p-button icon="pi pi-pencil" (onClick)="editOrder(order)" [rounded]="true" size="small" pTooltip="Editar" />
                        <p-button icon="pi pi-trash" (onClick)="confirmDeleteOrder(order)" [rounded]="true" severity="danger" size="small" pTooltip="Eliminar" />
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-card>

<!-- Order Dialog -->
<p-dialog [(visible)]="showOrderDialog" modal="true" styleClass="w-full md:w-9" [draggable]="false" [resizable]="false" [closable]="true"
    [header]="editingOrder ? 'Editar Pedido' : 'Nuevo Pedido'" (onHide)="closeOrderDialog()">

    <form [formGroup]="orderForm" class="flex flex-column gap-4" *ngIf="orderForm && formArrayReady">
        <!-- Order Header -->
        <div class="grid">
            <div class="col-12 md:col-6">
                <label for="orderId" class="block mb-2 font-semibold">ID del Pedido *</label>
                <p-inputgroup>
                    <p-inputgroup-addon>
                        <i class="pi pi-shopping-cart"></i>
                    </p-inputgroup-addon>
                    <input id="orderId" type="text" pInputText formControlName="id" class="w-full" placeholder="ORD-001" />
                </p-inputgroup>
                <app-error-helper [control]="orderForm.get('id')"></app-error-helper>
            </div>

            <div class="col-12 md:col-6">
                <label for="orderFecha" class="block mb-2 font-semibold">Fecha *</label>
                <p-inputgroup>
                    <p-inputgroup-addon>
                        <i class="pi pi-calendar"></i>
                    </p-inputgroup-addon>
                    <p-datepicker id="orderFecha" formControlName="date" class="w-full" dateFormat="dd/mm/yy" [showIcon]="true" />
                </p-inputgroup>
                <app-error-helper [control]="orderForm.get('date')"></app-error-helper>
            </div>
        </div>

        <!-- Customer Selection (New Orders) -->
        <div class="grid" *ngIf="!editingOrder">
            <div class="col-12">
                <label for="orderCliente" class="block mb-2 font-semibold">
                    <i class="pi pi-user mr-2"></i>Cliente *
                </label>
                <p-inputgroup>
                    <p-inputgroup-addon>
                        <i class="pi pi-user"></i>
                    </p-inputgroup-addon>
                    <p-select id="orderCliente" formControlName="customerId" [options]="customers" optionValue="id" placeholder="Seleccionar cliente" class="w-full" [showClear]="true">
                        <ng-template pTemplate="selectedItem" let-customer>
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-user"></i>
                                <div>{{ getCustomerDisplayName(customer) }}</div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="item" let-customer>
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-user"></i>
                                <div>
                                    <div class="font-semibold">{{ getCustomerDisplayName(customer) }}</div>
                                    <small class="text-500">{{ customer.email }}</small>
                                </div>
                            </div>
                        </ng-template>
                    </p-select>
                </p-inputgroup>
                <app-error-helper [control]="orderForm.get('customerId')"></app-error-helper>
            </div>
        </div>

        <!-- Customer Information (Read-only for Existing Orders) -->
        <p-card styleClass="border-round-xl shadow-2 p-3" *ngIf="editingOrder">
            <ng-template pTemplate="header">
                <div class="flex align-items-center justify-content-between">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-user text-primary text-xl"></i>
                        <h3 class="text-xl font-semibold text-primary m-0">Información del Cliente</h3>
                    </div>
                    <p-tag value="Solo lectura" severity="info" [rounded]="true" size="small"></p-tag>
                </div>
            </ng-template>

            <div class="grid">
                <!-- Personal Information -->
                <div class="col-12 xl:col-6">
                    <p-card styleClass="border-round-lg shadow-1 p-3">
                        <ng-template pTemplate="header">
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-id-card text-primary"></i>
                                <h4 class="text-lg font-semibold text-primary m-0">Datos Personales</h4>
                            </div>
                        </ng-template>

                        <div class="flex flex-column gap-4">
                            <!-- Name -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-primary-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-user text-primary text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Nombre Completo</span>
                                    <span class="text-lg font-semibold text-900">{{ editingOrder ? getCustomerDisplayName(editingOrder.customerSnapshot) : 'N/A' }}</span>
                                </div>
                            </div>

                            <!-- Email -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-blue-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-envelope text-blue-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Email</span>
                                    <span class="text-lg text-900">{{ editingOrder.customerSnapshot.email || 'N/A' }}</span>
                                </div>
                            </div>

                            <!-- Phone -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-green-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-phone text-green-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Teléfono</span>
                                    <span class="text-lg text-900">{{ editingOrder.customerSnapshot.phone || 'N/A' }}</span>
                                </div>
                            </div>

                            <!-- DNI -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-orange-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-id-card text-orange-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">DNI</span>
                                    <span class="text-lg text-900">{{ editingOrder.customerSnapshot.dni || 'N/A' }}</span>
                                </div>
                            </div>
                        </div>
                    </p-card>
                </div>

                <!-- Address Information -->
                <div class="col-12 xl:col-6">
                    <p-card styleClass="border-round-lg shadow-1 p-3">
                        <ng-template pTemplate="header">
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-map-marker text-primary"></i>
                                <h4 class="text-lg font-semibold text-primary m-0">Dirección de Residencia</h4>
                            </div>
                        </ng-template>

                        <div class="flex flex-column gap-4">
                            <!-- Address -->
                            <div class="flex align-items-start gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-purple-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-home text-purple-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Dirección</span>
                                    <span class="text-lg text-900">{{ editingOrder.customerSnapshot.address || 'N/A' }}</span>
                                    <span *ngIf="editingOrder.customerSnapshot.floorApartment" class="text-sm text-600">{{ editingOrder.customerSnapshot.floorApartment }}</span>
                                </div>
                            </div>

                            <!-- City -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-cyan-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-building text-cyan-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Ciudad</span>
                                    <span class="text-lg text-900">{{ editingOrder.customerSnapshot.city || 'N/A' }}</span>
                                </div>
                            </div>

                            <!-- Province -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-pink-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-map text-pink-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Provincia</span>
                                    <span class="text-lg text-900">{{ editingOrder.customerSnapshot.province || 'N/A' }}</span>
                                </div>
                            </div>

                            <!-- Postal Code -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-indigo-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-map-marker text-indigo-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Código Postal</span>
                                    <span class="text-lg text-900">{{ editingOrder.customerSnapshot.postalCode || 'N/A' }}</span>
                                </div>
                            </div>
                        </div>
                    </p-card>
                </div>
            </div>
        </p-card>

        <!-- Order Items -->
        <div class="surface-card border-round">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-list mr-2"></i>Productos del Pedido
            </h3>

            <div formArrayName="items" class="flex flex-column gap-3">
                <div *ngFor="let item of orderItemsArray.controls; let i = index" [formGroupName]="i" class="surface-100 p-3 border-round">
                    <div class="grid">
                        <div class="col-12 md:col-4">
                            <label class="block mb-2 font-semibold">Producto *</label>
                            <p-select formControlName="product" [options]="allProducts" optionLabel="name" placeholder="Seleccionar producto" class="w-full" (onChange)="onProductChange(i)"
                                [showClear]="true">
                                <ng-template pTemplate="selectedItem" let-product>
                                    <div class="flex align-items-center gap-2">
                                        <i class="pi pi-box"></i>
                                        <div>{{ product.name }}</div>
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="item" let-product>
                                    <div class="flex align-items-center gap-2">
                                        <i class="pi pi-box"></i>
                                        <div>
                                            <div class="font-semibold">{{ product.name }}</div>
                                            <small class="text-500">{{ product.price | currency:'ARS':'symbol':'1.0-0' }}</small>
                                        </div>
                                    </div>
                                </ng-template>
                            </p-select>
                            <!-- Product Type Indicator -->
                            <div class="mt-2" *ngIf="orderItemsArray.at(i).get('product')?.value">
                                <p-tag [value]="getProductTypeLabel(i)" [severity]="getProductTypeSeverity(i)" [rounded]="true" size="small"></p-tag>
                            </div>
                        </div>
                        <div class="col-12 md:col-3">
                            <label for="color" class="block mb-2">Color:</label>
                            <p-select id="color" formControlName="selectedColor" [options]="getAvailableColorsForItem(i)" placeholder="Seleccione color" (onChange)="onColorChange(i)"
                                [showClear]="true"></p-select>
                        </div>
                        <div class="col-12 md:col-2">
                            <label for="size" class="block mb-2">Talle:</label>
                            <p-select id="size" formControlName="selectedSize" [options]="getAvailableSizesForItem(i)" placeholder="Seleccione talle" (onChange)="onSizeChange()"
                                [showClear]="true"></p-select>
                        </div>
                        <div class="col-12 md:col-4">
                            <label class="block mb-2 font-semibold">Cantidad *</label>
                            <p-inputnumber formControlName="quantity" [min]="1" [showButtons]="true" buttonLayout="horizontal" spinnerMode="horizontal" inputStyleClass="text-center"
                                decrementButtonClass="p-button-secondary" incrementButtonClass="p-button-secondary" incrementButtonIcon="pi pi-plus" decrementButtonIcon="pi pi-minus"
                                class="w-auto" (onInput)="onItemChange()" />
                        </div>
                        <div class="col-12 md:col-1">
                            <label class="block mb-2 font-semibold">Precio Unit.</label>
                            <div class="p-2 surface-200 border-round text-center">
                                <span class="font-bold text-primary">${{ getItemUnitPrice(i) | number:'1.0-0' }}</span>
                            </div>
                        </div>
                        <div class="col-12 md:col-1">
                            <label class="block mb-2 font-semibold">Acciones</label>
                            <p-button icon="pi pi-trash" (onClick)="removeOrderItem(i)" [rounded]="true" severity="danger" size="small" pTooltip="Eliminar item" />
                        </div>
                    </div>

                    <!-- Customization Details for Personalizado Products -->
                    <div class="mt-3" *ngIf="isProductPersonalizado(i)">
                        <div class="surface-200 p-3 border-round">
                            <h4 class="text-sm font-semibold mb-2 text-primary">
                                <i class="pi pi-palette mr-1"></i>Detalles de Personalización
                            </h4>

                            <!-- Thread Colors -->
                            <div class="grid mb-2" *ngIf="getProductThreadColors(i).length > 0">
                                <div class="col-12">
                                    <span class="text-sm text-600">Colores de Hilo:</span>
                                    <div class="flex gap-2 mt-1">
                                        <div *ngFor="let color of getProductThreadColors(i)" class="flex align-items-center gap-2">
                                            <div class="border-circle border-1 border-300 w-2rem h-2rem" [pTooltip]="color.name" tooltipPosition="top"
                                                [ngStyle]="{'background-color': color.code, 'background-image': 'repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0px, rgba(255, 255, 255, 0.1) 1px, transparent 1px, transparent 4px)'}">
                                            </div>
                                            <span class="text-sm font-medium">{{ color.name }} ({{ color.code }})</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Custom Text -->
                            <div class="grid mb-2" *ngIf="getProductCustomText(i)">
                                <div class="col-12">
                                    <span class="text-sm text-600">Texto Personalizado:</span>
                                    <div class="flex align-items-center gap-2 mt-1">
                                        <p-tag *ngIf="getProductCustomTextColor(i)?.code" [value]="getProductCustomText(i)" [style]="{'color': getProductCustomTextColor(i)?.code}"
                                            [rounded]="true" size="small">
                                        </p-tag>
                                        <div class="flex align-items-center gap-2">
                                            <div class="border-circle border-1 border-300 w-2rem h-2rem" [pTooltip]="getProductCustomTextColor(i)?.name" tooltipPosition="top"
                                                [ngStyle]="{'background-color': getProductCustomTextColor(i)?.code, 'background-image': 'repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0px, rgba(255, 255, 255, 0.1) 1px, transparent 1px, transparent 4px)'}">
                                            </div>
                                            Color: <span class="text-sm font-medium">{{ getProductCustomTextColor(i)?.name }} ({{ getProductCustomTextColor(i)?.code }})</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Custom Image -->
                            <div class="grid mb-2" *ngIf="getProductCustomImage(i)">
                                <div class="col-12">
                                    <span class="text-sm text-600">Imagen Personalizada:</span>
                                    <div class="mt-1">
                                        <p-image [src]="getProductCustomImage(i)" alt="Imagen personalizada" width="100" height="100" [preview]="true" styleClass="border-round shadow-1">
                                        </p-image>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Item Summary -->
                    <div class="grid mt-2">
                        <div class="col-12 md:col-4">
                            <div class="flex flex-column">
                                <span class="text-sm text-600">Subtotal Bruto</span>
                                <span class="font-bold text-primary">${{ getItemGrossSubtotal(i) | number:'1.0-0' }}</span>
                            </div>
                        </div>
                        <div class="col-12 md:col-4">
                            <div class="flex flex-column">
                                <span class="text-sm text-600">Descuento Total</span>
                                <span class="font-bold text-green-600">-${{ getItemTotalDiscount(i) | number:'1.0-0' }}</span>
                            </div>
                        </div>
                        <div class="col-12 md:col-4">
                            <div class="flex flex-column">
                                <span class="text-sm text-600">Subtotal Final</span>
                                <span class="font-bold text-primary">${{ getItemSubtotal(i) | number:'1.0-0' }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-content-center mt-3">
                <p-button label="Agregar Producto" icon="pi pi-plus" (onClick)="addOrderItem()" [outlined]="true" />
            </div>
        </div>

        <!-- Coupon Section -->
        <div class="surface-card border-round">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-ticket mr-2"></i>Cupón de Descuento
            </h3>
            <div class="grid">
                <div class="col-12 md:col-6">
                    <label for="orderCupon" class="block mb-2 font-semibold">Código de Cupón</label>
                    <p-inputgroup>
                        <p-inputgroup-addon>
                            <i class="pi pi-ticket"></i>
                        </p-inputgroup-addon>
                        <input id="orderCupon" type="text" pInputText formControlName="couponCode" class="w-full" placeholder="Ingresar código" />
                        <p-button icon="pi pi-check" (onClick)="validateAndApplyCoupon()" [loading]="couponLoading" pTooltip="Validar cupón" />
                    </p-inputgroup>
                </div>
                <div class="col-12 md:col-6">
                    <div class="flex align-items-center gap-2">
                        <span class="font-semibold">Descuento Aplicado:</span>
                        <span class="font-bold text-green-600">
                            -{{ orderForm.get('couponDiscount')?.value | currency:'ARS':'symbol':'1.0-0' }}
                        </span>
                        <p-button *ngIf="selectedCoupon" icon="pi pi-times" (onClick)="clearCoupon()" [rounded]="true" size="small" severity="danger" pTooltip="Remover cupón" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Shipping Information -->
        <div class="surface-card border-round">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-truck mr-2"></i>Información de Envío
            </h3>
            <div class="grid">
                <div class="col-12 md:col-6">
                    <label for="orderEnvioDireccion" class="block mb-2 font-semibold">Dirección de Envío *</label>
                    <p-inputgroup>
                        <p-inputgroup-addon>
                            <i class="pi pi-home"></i>
                        </p-inputgroup-addon>
                        <input id="orderEnvioDireccion" type="text" pInputText formControlName="shippingAddress" class="w-full" placeholder="Calle y número" />
                    </p-inputgroup>
                    <app-error-helper [control]="orderForm.get('shippingAddress')"></app-error-helper>
                </div>
                <div class="col-12 md:col-6">
                    <label for="orderEnvioCiudad" class="block mb-2 font-semibold">Ciudad *</label>
                    <p-inputgroup>
                        <p-inputgroup-addon>
                            <i class="pi pi-map"></i>
                        </p-inputgroup-addon>
                        <input id="orderEnvioCiudad" type="text" pInputText formControlName="shippingCity" class="w-full" placeholder="Ciudad" />
                    </p-inputgroup>
                    <app-error-helper [control]="orderForm.get('shippingCity')"></app-error-helper>
                </div>
            </div>
            <div class="grid">
                <div class="col-12 md:col-4">
                    <label for="orderEnvioProvincia" class="block mb-2 font-semibold">Provincia *</label>
                    <p-inputgroup>
                        <p-inputgroup-addon>
                            <i class="pi pi-map-marker"></i>
                        </p-inputgroup-addon>
                        <input id="orderEnvioProvincia" type="text" pInputText formControlName="shippingProvince" class="w-full" placeholder="Provincia" />
                    </p-inputgroup>
                    <app-error-helper [control]="orderForm.get('shippingProvince')"></app-error-helper>
                </div>
                <div class="col-12 md:col-4">
                    <label for="orderEnvioCP" class="block mb-2 font-semibold">Código Postal *</label>
                    <p-inputgroup>
                        <p-inputgroup-addon>
                            <i class="pi pi-map"></i>
                        </p-inputgroup-addon>
                        <input id="orderEnvioCP" type="text" pInputText formControlName="shippingPostalCode" class="w-full" placeholder="1234" maxlength="5" />
                    </p-inputgroup>
                    <app-error-helper [control]="orderForm.get('shippingPostalCode')"></app-error-helper>
                </div>
                <div class="col-12 md:col-4">
                    <label for="orderEnvioPiso" class="block mb-2 font-semibold">Piso/Depto</label>
                    <p-inputgroup>
                        <p-inputgroup-addon>
                            <i class="pi pi-building"></i>
                        </p-inputgroup-addon>
                        <input id="orderEnvioPiso" type="text" pInputText formControlName="shippingFloorApartment" class="w-full" placeholder="Piso 2, Depto A" />
                    </p-inputgroup>
                    <app-error-helper [control]="orderForm.get('shippingFloorApartment')"></app-error-helper>
                </div>
            </div>
            <div class="grid">
                <div class="col-12 md:col-6">
                    <label for="orderEnvioPrecio" class="block mb-2 font-semibold">Precio de Envío</label>
                    <p-inputnumber formControlName="shippingPrice" [min]="0" mode="currency" currency="ARS" locale="es-AR" class="w-full" (onInput)="calculateOrderTotals()" />
                </div>
            </div>

            <div class="grid">
                <div class="col-12">
                    <label for="orderNotas" class="block mb-2 font-semibold">Notas</label>
                    <textarea pTextarea id="orderNotas" formControlName="notes" rows="3" placeholder="Notas adicionales del pedido..." class="w-full"></textarea>
                </div>
            </div>
        </div>

        <!-- Order Details -->
        <div class="grid">
            <div class="col-12 md:col-6">
                <label for="orderEstado" class="block mb-2 font-semibold">Estado *</label>
                <p-select formControlName="status" [options]="orderStatusOptions" optionLabel="label" optionValue="value" placeholder="Seleccionar estado" class="w-full" />
            </div>
            <div class="col-12 md:col-6">
                <label for="orderPago" class="block mb-2 font-semibold">Método de Pago *</label>
                <p-select formControlName="paymentMethod" [options]="paymentMethodOptions" optionLabel="label" optionValue="value" placeholder="Seleccionar método" class="w-full" />
            </div>
        </div>

        <!-- Order Summary -->
        <div class="surface-card border-round">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-calculator mr-2"></i>Resumen del Pedido
            </h3>
            <div class="grid">
                <div class="col-12 md:col-3">
                    <div class="text-center p-3 surface-100 border-round">
                        <i class="pi pi-dollar text-2xl text-blue-500 mb-2 block"></i>
                        <div class="text-sm text-600 mb-1">Subtotal</div>
                        <div class="text-xl font-bold text-blue-500">{{ orderForm.get('subtotal')?.value | currency:'ARS':'symbol':'1.0-0' }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="text-center p-3 surface-100 border-round">
                        <i class="pi pi-ticket text-2xl text-green-500 mb-2 block"></i>
                        <div class="text-sm text-600 mb-1">Descuento Cupón</div>
                        <div class="text-xl font-bold text-green-500">-{{ orderForm.get('couponDiscount')?.value | currency:'ARS':'symbol':'1.0-0' }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="text-center p-3 surface-100 border-round">
                        <i class="pi pi-truck text-2xl text-orange-500 mb-2 block"></i>
                        <div class="text-sm text-600 mb-1">Envío</div>
                        <div class="text-xl font-bold text-orange-500">{{ orderForm.get('shippingPrice')?.value | currency:'ARS':'symbol':'1.0-0' }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="text-center p-3 surface-100 border-round">
                        <i class="pi pi-chart-bar text-2xl text-purple-500 mb-2 block"></i>
                        <div class="text-sm text-600 mb-1">Total</div>
                        <div class="text-xl font-bold text-purple-500">{{ orderForm.get('total')?.value | currency:'ARS':'symbol':'1.0-0' }}</div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-end gap-2 mt-3">
            <p-button label="Cancelar" icon="pi pi-times" [outlined]="true" (onClick)="closeOrderDialog()" [disabled]="orderLoading" />
            <p-button label="Guardar" icon="pi pi-check" (onClick)="saveOrder()" [disabled]="!orderForm.valid || orderLoading" [loading]="orderLoading" />
        </div>
    </ng-template>
</p-dialog>

<!-- Order Details Dialog -->
<p-dialog [(visible)]="showOrderDetailsDialog" modal="true" styleClass="w-full md:w-8" [draggable]="false" [resizable]="false" [closable]="true" header="Detalles del Pedido"
    (onHide)="showOrderDetailsDialog = false">

    <div class="surface-ground p-4" *ngIf="selectedOrder">
        <!-- Order Header -->
        <div class="surface-card p-4 border-round mb-4">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-shopping-cart mr-2"></i>Información del Pedido
            </h3>
            <div class="grid">
                <div class="col-12 md:col-6">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">ID del Pedido</span>
                        <span class="font-bold text-900">{{ selectedOrder.id }}</span>
                    </div>
                </div>
                <div class="col-12 md:col-6">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">Fecha</span>
                        <span class="text-900">{{ selectedOrder.date | date:'dd/MM/yyyy HH:mm' }}</span>
                    </div>
                </div>
                <div class="col-12 md:col-6">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">Estado</span>
                        <p-tag [value]="getOrderStatusLabel(selectedOrder.status)" [severity]="getOrderStatusSeverity(selectedOrder.status)" [rounded]="true"></p-tag>
                    </div>
                </div>
                <div class="col-12 md:col-6">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">Método de Pago</span>
                        <span class="text-900">{{ getPaymentMethodLabel(selectedOrder.paymentMethod) }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Information -->
        <p-card styleClass="border-round-xl shadow-2 p-3 mb-4">
            <ng-template pTemplate="header">
                <div class="flex align-items-center justify-content-between">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-user text-primary text-xl"></i>
                        <h3 class="text-xl font-semibold text-primary m-0">Información del Cliente</h3>
                    </div>
                    <p-tag value="Cliente Registrado" severity="success" [rounded]="true" size="small"></p-tag>
                </div>
            </ng-template>

            <div class="grid">
                <!-- Personal Information -->
                <div class="col-12 xl:col-6">
                    <p-card styleClass="border-round-lg shadow-1 p-3">
                        <ng-template pTemplate="header">
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-id-card text-primary"></i>
                                <h4 class="text-lg font-semibold text-primary m-0">Datos Personales</h4>
                            </div>
                        </ng-template>

                        <div class="flex flex-column gap-4">
                            <!-- Name -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-primary-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-user text-primary text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Nombre Completo</span>
                                    <span class="text-lg font-semibold text-900">{{ selectedOrder.getCustomerName() }}</span>
                                </div>
                            </div>

                            <!-- Email -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-blue-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-envelope text-blue-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Email</span>
                                    <span class="text-lg text-900">{{ selectedOrder.getCustomerEmail() }}</span>
                                </div>
                            </div>

                            <!-- Phone -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-green-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-phone text-green-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Teléfono</span>
                                    <span class="text-lg text-900">{{ selectedOrder.getCustomerPhone() }}</span>
                                </div>
                            </div>

                            <!-- DNI -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-orange-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-id-card text-orange-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">DNI</span>
                                    <span class="text-lg text-900">{{ selectedOrder.customerSnapshot.dni || 'N/A' }}</span>
                                </div>
                            </div>
                        </div>
                    </p-card>
                </div>

                <!-- Address Information -->
                <div class="col-12 xl:col-6">
                    <p-card styleClass="border-round-lg shadow-1 p-3">
                        <ng-template pTemplate="header">
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-map-marker text-primary"></i>
                                <h4 class="text-lg font-semibold text-primary m-0">Dirección de Residencia</h4>
                            </div>
                        </ng-template>

                        <div class="flex flex-column gap-4">
                            <!-- Address -->
                            <div class="flex align-items-start gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-purple-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-home text-purple-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Dirección</span>
                                    <span class="text-lg text-900">{{ selectedOrder.customerSnapshot.address || 'N/A' }}</span>
                                    <span *ngIf="selectedOrder.customerSnapshot.floorApartment" class="text-sm text-600">{{ selectedOrder.customerSnapshot.floorApartment }}</span>
                                </div>
                            </div>

                            <!-- City -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-cyan-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-building text-cyan-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Ciudad</span>
                                    <span class="text-lg text-900">{{ selectedOrder.customerSnapshot.city || 'N/A' }}</span>
                                </div>
                            </div>

                            <!-- Province -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-pink-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-map text-pink-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Provincia</span>
                                    <span class="text-lg text-900">{{ selectedOrder.customerSnapshot.province || 'N/A' }}</span>
                                </div>
                            </div>

                            <!-- Postal Code -->
                            <div class="flex align-items-center gap-3 p-3 surface-50 border-round">
                                <div class="flex align-items-center justify-content-center bg-indigo-50 border-round-xl w-3rem h-3rem">
                                    <i class="pi pi-map-marker text-indigo-500 text-xl"></i>
                                </div>
                                <div class="flex flex-column">
                                    <span class="text-sm text-600 font-medium">Código Postal</span>
                                    <span class="text-lg text-900">{{ selectedOrder.customerSnapshot.postalCode || 'N/A' }}</span>
                                </div>
                            </div>
                        </div>
                    </p-card>
                </div>
            </div>
        </p-card>

        <!-- Shipping Address -->
        <div class="surface-card p-4 border-round mb-4">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-truck mr-2"></i>Dirección de Envío
            </h3>
            <div class="grid">
                <div class="col-12 md:col-6">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">Dirección</span>
                        <span class="text-900">{{ selectedOrder.shippingAddress }}</span>
                    </div>
                </div>
                <div class="col-12 md:col-6">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">Ciudad</span>
                        <span class="text-900">{{ selectedOrder.shippingCity }}</span>
                    </div>
                </div>
                <div class="col-12 md:col-6">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">Provincia</span>
                        <span class="text-900">{{ selectedOrder.shippingProvince }}</span>
                    </div>
                </div>
                <div class="col-12 md:col-6">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">Código Postal</span>
                        <span class="text-900">{{ selectedOrder.shippingPostalCode }}</span>
                    </div>
                </div>
                <div class="col-12" *ngIf="selectedOrder.shippingFloorApartment">
                    <div class="flex flex-column mb-3">
                        <span class="text-sm text-600 mb-1">Piso/Departamento</span>
                        <span class="text-900">{{ selectedOrder.shippingFloorApartment }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Items -->
        <div class="surface-card p-4 border-round mb-4">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-list mr-2"></i>Productos del Pedido
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-bottom-1 surface-border">
                            <th class="text-left p-3">Producto</th>
                            <th class="text-left p-3">Cantidad</th>
                            <th class="text-left p-3">Color</th>
                            <th class="text-left p-3">Talle</th>
                            <th class="text-left p-3">Precio Unit.</th>
                            <th class="text-left p-3">Descuento</th>
                            <th class="text-left p-3">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of selectedOrder?.items; let i = index" class="border-bottom-1 surface-border">
                            <td class="p-3">
                                <div class="flex align-items-center gap-2">
                                    <img *ngIf="item.getProductImage()" [src]="item.getProductImage()" alt="Imagen" width="40" height="40" class="border-round shadow-1" />
                                    <div class="flex flex-column">
                                        <span>{{ item.getProductName() }}</span>
                                        <!-- Product Type Tag -->
                                        <p-tag *ngIf="item.productSnapshot.type === 'personalizable'" value="Personalizado" severity="warn" [rounded]="true" size="small"
                                            icon="pi pi-palette"></p-tag>
                                        <p-tag *ngIf="item.productSnapshot.type === 'bordado'" value="Bordado" severity="success" [rounded]="true" size="small"
                                            icon="pi pi-check-circle"></p-tag>
                                    </div>
                                </div>
                            </td>
                            <td class="p-3">{{ item.quantity }}</td>
                            <td class="p-3">{{ item.productSnapshot.variant.color || '-' }}</td>
                            <td class="p-3">{{ item.productSnapshot.variant.size || '-' }}</td>
                            <td class="p-3">{{ item.getUnitPrice() | currency:'ARS':'symbol':'1.0-0':'es-AR' }}</td>
                            <td class="p-3">{{ item.getProductDiscount() | currency:'ARS':'symbol':'1.0-0':'es-AR' }}</td>
                            <td class="p-3">{{ item.subtotal | currency:'ARS':'symbol':'1.0-0':'es-AR' }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Customization Details for Personalizable Products -->
            <ng-container *ngFor="let item of selectedOrder?.items; let i = index">
                <div *ngIf="item.productSnapshot.type === 'personalizable' && item.customization" class="mt-3">
                    <div class="surface-200 p-3 border-round">
                        <h4 class="text-sm font-semibold mb-2 text-primary">
                            <i class="pi pi-palette mr-1"></i>Detalles de Personalización - {{ item.getProductName() }}
                        </h4>

                        <!-- Thread Colors -->
                        <div class="grid mb-2" *ngIf="item.customization.threadColor1 || item.customization.threadColor2">
                            <div class="col-12">
                                <span class="text-sm text-600">Colores de Hilo:</span>
                                <div class="flex gap-2 mt-1">
                                    <div *ngIf="item.customization.threadColor1" class="flex align-items-center gap-2">
                                        <div class="border-circle border-1 border-300 w-2rem h-2rem" [pTooltip]="getColorNameById(item.customization.threadColor1)" tooltipPosition="top"
                                            [ngStyle]="{'background-color': getColorCodeById(item.customization.threadColor1), 'background-image': 'repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0px, rgba(255, 255, 255, 0.1) 1px, transparent 1px, transparent 4px)'}">
                                        </div>
                                        <span class="text-sm font-medium">{{ getColorNameById(item.customization.threadColor1) }} ({{ getColorCodeById(item.customization.threadColor1)
                                            }})</span>
                                    </div>
                                    <div *ngIf="item.customization.threadColor2" class="flex align-items-center gap-2">
                                        <div class="border-circle border-1 border-300 w-2rem h-2rem" [pTooltip]="getColorNameById(item.customization.threadColor2)" tooltipPosition="top"
                                            [ngStyle]="{'background-color': getColorCodeById(item.customization.threadColor2), 'background-image': 'repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0px, rgba(255, 255, 255, 0.1) 1px, transparent 1px, transparent 4px)'}">
                                        </div>
                                        <span class="text-sm font-medium">{{ getColorNameById(item.customization.threadColor2) }} ({{ getColorCodeById(item.customization.threadColor2)
                                            }})</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Custom Text -->
                        <div class="grid mb-2" *ngIf="item.customization.customText">
                            <div class="col-12">
                                <span class="text-sm text-600">Texto Personalizado:</span>
                                <div class="flex align-items-center gap-2 mt-1">
                                    <p-tag *ngIf="item.customization.customTextColor" [value]="item.customization.customText"
                                        [style]="{'color': getColorCodeById(item.customization.customTextColor)}" [rounded]="true" size="small">
                                    </p-tag>
                                    <div *ngIf="item.customization.customTextColor" class="flex align-items-center gap-2">
                                        <div class="border-circle border-1 border-300 w-2rem h-2rem" [pTooltip]="getColorNameById(item.customization.customTextColor)" tooltipPosition="top"
                                            [ngStyle]="{'background-color': getColorCodeById(item.customization.customTextColor), 'background-image': 'repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0px, rgba(255, 255, 255, 0.1) 1px, transparent 1px, transparent 4px)'}">
                                        </div>
                                        Color: <span class="text-sm font-medium">{{ getColorNameById(item.customization.customTextColor) }} ({{
                                            getColorCodeById(item.customization.customTextColor) }})</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Custom Image -->
                        <div class="grid mb-2" *ngIf="item.customization.customImage">
                            <div class="col-12">
                                <span class="text-sm text-600">Imagen Personalizada:</span>
                                <div class="mt-1">
                                    <p-image [src]="item.customization.customImage" alt="Imagen personalizada" width="100" height="100" [preview]="true" styleClass="border-round shadow-1">
                                    </p-image>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>

        <!-- Coupon Information -->
        <div class="surface-card p-4 border-round" *ngIf="selectedOrder.couponCode">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-ticket mr-2"></i>Cupón Aplicado
            </h3>
            <div class="grid">
                <div class="col-12 md:col-6">
                    <div class="flex align-items-center gap-2">
                        <p-tag [value]="selectedOrder.couponCode" severity="success" [rounded]="true"></p-tag>
                        <span class="font-semibold text-green-700">Cupón de Descuento</span>
                    </div>
                </div>
                <div class="col-12 md:col-6">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-dollar text-green-500"></i>
                        <span class="font-semibold">Descuento Aplicado:</span>
                        <span class="font-bold text-green-600">
                            -{{ selectedOrder.couponDiscount | currency:'ARS':'symbol':'1.0-0' }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="surface-card p-4 border-round">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-calculator mr-2"></i>Resumen del Pedido
            </h3>
            <div class="grid">
                <div class="col-12 md:col-3">
                    <div class="text-center p-3 surface-100 border-round">
                        <i class="pi pi-dollar text-2xl text-blue-500 mb-2 block"></i>
                        <div class="text-sm text-600 mb-1">Subtotal</div>
                        <div class="text-xl font-bold text-blue-500">{{ selectedOrder.subtotal | currency:'ARS':'symbol':'1.0-0' }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="text-center p-3 surface-100 border-round">
                        <i class="pi pi-ticket text-2xl text-green-500 mb-2 block"></i>
                        <div class="text-sm text-600 mb-1">Descuento Cupón</div>
                        <div class="text-xl font-bold text-green-500">-{{ selectedOrder.couponDiscount | currency:'ARS':'symbol':'1.0-0' }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="text-center p-3 surface-100 border-round">
                        <i class="pi pi-truck text-2xl text-orange-500 mb-2 block"></i>
                        <div class="text-sm text-600 mb-1">Envío</div>
                        <div class="text-xl font-bold text-orange-500">{{ selectedOrder.shippingPrice | currency:'ARS':'symbol':'1.0-0' }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="text-center p-3 surface-100 border-round">
                        <i class="pi pi-chart-bar text-2xl text-purple-500 mb-2 block"></i>
                        <div class="text-sm text-600 mb-1">Total</div>
                        <div class="text-xl font-bold text-purple-500">{{ selectedOrder.total | currency:'ARS':'symbol':'1.0-0' }}</div>
                    </div>
                </div>
            </div>

            <!-- Tax Information -->
            <div class="surface-100 p-3 border-round mt-3">
                <div class="flex justify-content-between align-items-center">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-percentage text-blue-500"></i>
                        <span class="font-semibold">IVA (21%):</span>
                    </div>
                    <span class="font-bold text-primary text-lg">{{ (selectedOrder.subtotal * 0.21) | currency:'ARS':'symbol':'1.0-0' }}</span>
                </div>
            </div>
        </div>

        <!-- Notes -->
        <div class="surface-card p-4 border-round" *ngIf="selectedOrder.notes">
            <h3 class="text-lg font-semibold mb-3 text-primary">
                <i class="pi pi-comment mr-2"></i>Notas del Pedido
            </h3>
            <div class="surface-100 p-3 border-round">
                <p class="m-0 text-600">{{ selectedOrder.notes }}</p>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-end gap-2 mt-3">
            <p-button label="Editar Pedido" icon="pi pi-pencil" [outlined]="true" (onClick)="editOrder(selectedOrder!)" />
            <p-button label="Cerrar" icon="pi pi-times" (onClick)="showOrderDetailsDialog = false" />
        </div>
    </ng-template>
</p-dialog>