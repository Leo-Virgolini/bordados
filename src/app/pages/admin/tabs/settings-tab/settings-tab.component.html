<!-- Settings Loading State -->
<div *ngIf="settingsLoading" class="flex justify-content-center align-items-center" style="min-height: 400px;">
    <div class="text-center">
        <i class="pi pi-spin pi-spinner text-6xl text-primary mb-3"></i>
        <h3 class="text-xl font-semibold text-600">Cargando configuración...</h3>
        <p class="text-500">Espera mientras se cargan los datos</p>
    </div>
</div>

<!-- Settings Content -->
<div *ngIf="!settingsLoading">
    <!-- Contact Settings -->
    <p-card class="border-round-xl shadow-3 p-3 mb-4">
        <ng-template #header>
            <div class="flex justify-content-between align-items-center">
                <h3 class="text-lg font-bold m-0">
                    <i class="pi pi-phone mr-2"></i>Configuración de Contacto
                </h3>
            </div>
        </ng-template>

        <form [formGroup]="contactForm" class="flex flex-column gap-4" *ngIf="contactForm">

            <div>
                <label for="whatsappPhone" class="block mb-2 font-semibold">Número de WhatsApp *</label>
                <p-inputgroup class="max-w-max">
                    <p-inputgroup-addon>
                        <i class="pi pi-whatsapp"></i>
                    </p-inputgroup-addon>
                    <p-inputgroup-addon class="bg-gray-100 font-semibold text-gray-600">
                        +54 9
                    </p-inputgroup-addon>
                    <p-inputmask id="whatsappPhone" formControlName="whatsappPhone" styleClass="w-full" placeholder="11 1234-5678" mask="99 9999-9999" [unmask]="true" />
                </p-inputgroup>
                <app-error-helper [control]="contactForm.get('whatsappPhone')"></app-error-helper>
                <small class="text-color-secondary">Número que se usará para el botón de WhatsApp</small>
            </div>


            <div class="flex justify-content-end gap-2 mt-3">
                <p-button label="Guardar Configuración" icon="pi pi-check" (onClick)="saveContactSettings()" [disabled]="!contactForm.valid || phoneLoading" [loading]="phoneLoading" />
            </div>
        </form>
    </p-card>

    <!-- Social Media Settings -->
    <p-card class="border-round-xl shadow-3 p-3 mb-4">
        <ng-template #header>
            <div class="flex justify-content-between align-items-center">
                <h3 class="text-lg font-bold m-0">
                    <i class="pi pi-share-alt mr-2"></i>Configuración de Redes Sociales
                </h3>
            </div>
        </ng-template>

        <form [formGroup]="socialMediaForm" class="flex flex-column gap-4" *ngIf="socialMediaForm">
            <div class="grid">
                <div class="col-12 md:col-6">
                    <label for="facebookUrl" class="block mb-2 font-semibold">URL de Facebook</label>
                    <p-inputgroup class="max-w-max">
                        <p-inputgroup-addon>
                            <i class="pi pi-facebook text-blue-600"></i>
                        </p-inputgroup-addon>
                        <input pInputText id="facebookUrl" formControlName="facebookUrl" placeholder="https://facebook.com/tu-pagina" class="w-full" />
                    </p-inputgroup>
                    <app-error-helper [control]="socialMediaForm.get('facebookUrl')"></app-error-helper>
                    <small class="text-color-secondary">URL completa de tu página de Facebook</small>
                </div>

                <div class="col-12 md:col-6">
                    <label for="instagramUrl" class="block mb-2 font-semibold">URL de Instagram</label>
                    <p-inputgroup class="max-w-max">
                        <p-inputgroup-addon>
                            <i class="pi pi-instagram text-pink-600"></i>
                        </p-inputgroup-addon>
                        <input pInputText id="instagramUrl" formControlName="instagramUrl" placeholder="https://instagram.com/tu-usuario" class="w-full" />
                    </p-inputgroup>
                    <app-error-helper [control]="socialMediaForm.get('instagramUrl')"></app-error-helper>
                    <small class="text-color-secondary">URL completa de tu perfil de Instagram</small>
                </div>

                <div class="col-12 md:col-6">
                    <label for="tiktokUrl" class="block mb-2 font-semibold">URL de TikTok</label>
                    <p-inputgroup class="max-w-max">
                        <p-inputgroup-addon>
                            <i class="pi pi-tiktok text-black"></i>
                        </p-inputgroup-addon>
                        <input pInputText id="tiktokUrl" formControlName="tiktokUrl" placeholder="https://tiktok.com/@tu-usuario" class="w-full" />
                    </p-inputgroup>
                    <app-error-helper [control]="socialMediaForm.get('tiktokUrl')"></app-error-helper>
                    <small class="text-color-secondary">URL completa de tu perfil de TikTok</small>
                </div>
            </div>

            <div class="flex justify-content-end gap-2 mt-3">
                <p-button label="Guardar Configuración" icon="pi pi-check" (onClick)="saveSocialMediaSettings()" [disabled]="!socialMediaForm.valid || socialMediaLoading"
                    [loading]="socialMediaLoading" />
            </div>
        </form>
    </p-card>

    <!-- Free Shipping Settings -->
    <p-card class="border-round-xl shadow-3 p-3 mb-4">
        <ng-template #header>
            <div class="flex justify-content-between align-items-center">
                <h3 class="text-lg font-bold m-0">
                    <i class="pi pi-percentage mr-2"></i>Configuración de Envío Gratis y Descuentos
                </h3>
            </div>
        </ng-template>

        <form [formGroup]="shippingForm" class="flex flex-column gap-4" *ngIf="shippingForm">
            <div class="grid">
                <div class="col-12 md:col-6">
                    <label for="freeShippingThreshold" class="block mb-2 font-semibold">Monto mínimo para envío gratis *</label>
                    <p-inputgroup class="max-w-max">
                        <p-inputgroup-addon>
                            <i class="pi pi-dollar"></i>
                        </p-inputgroup-addon>
                        <p-inputnumber id="freeShippingThreshold" formControlName="freeShippingThreshold" class="w-full" placeholder="0" [min]="0" [max]="999999" [showButtons]="true"
                            buttonLayout="horizontal" spinnerMode="horizontal" [step]="1000" mode="currency" currency="ARS" />
                    </p-inputgroup>
                    <app-error-helper [control]="shippingForm.get('freeShippingThreshold')"></app-error-helper>
                    <small class="text-color-secondary">Los pedidos con este monto o superior tendrán envío gratis</small>
                </div>
                <div class="col-12 md:col-6">
                    <label for="discountPercentage" class="block mb-2 font-semibold">Porcentaje de descuento por transferencia *</label>
                    <p-inputgroup class="max-w-max">
                        <p-inputgroup-addon>
                            <i class="pi pi-percentage"></i>
                        </p-inputgroup-addon>
                        <p-inputnumber id="discountPercentage" formControlName="discountPercentage" class="w-full" placeholder="10" [min]="0" [max]="100" [showButtons]="true"
                            buttonLayout="horizontal" spinnerMode="horizontal" [step]="5" />
                        <p-inputgroup-addon class="pl-3 pr-3 bg-gray-100 font-semibold text-gray-600">
                            %
                        </p-inputgroup-addon>
                    </p-inputgroup>
                    <app-error-helper [control]="priceForm.get('discountPercentage')"></app-error-helper>
                    <small class="text-color-secondary">Descuento actual: {{ discountPercentage }}% (0% - 100%)</small>
                </div>
            </div>

            <div class="flex justify-content-end gap-2 mt-3">
                <p-button label="Guardar Configuración" icon="pi pi-check" (onClick)="saveShippingSettings()" [disabled]="!shippingForm.valid || shippingLoading"
                    [loading]="shippingLoading" />
            </div>
        </form>
    </p-card>

    <!-- Prices Settings -->
    <p-card class="border-round-xl shadow-3 p-3 mb-4">
        <ng-template #header>
            <div class="flex justify-content-between align-items-center">
                <h3 class="text-lg font-bold m-0">
                    <i class="pi pi-palette mr-2"></i>Configuración de Personalización
                </h3>
            </div>
        </ng-template>

        <form [formGroup]="priceForm" class="flex flex-column gap-4" *ngIf="priceForm">
            <div>
                <label for="maxImageSize" class="block mb-2 font-semibold">Tamaño máximo de imagen *</label>
                <p-inputgroup class="max-w-max">
                    <p-inputgroup-addon>
                        <i class="pi pi-image"></i>
                    </p-inputgroup-addon>
                    <p-inputnumber id="maxImageSize" formControlName="maxImageSize" class="w-full" placeholder="10485760" [min]="1024 * 1024" [max]="50 * 1024 * 1024" [showButtons]="true"
                        buttonLayout="horizontal" spinnerMode="horizontal" [step]="1024 * 1024" />
                    <p-inputgroup-addon class="bg-gray-100 font-semibold text-gray-600">
                        bytes
                    </p-inputgroup-addon>
                </p-inputgroup>
                <app-error-helper [control]="priceForm.get('maxImageSize')"></app-error-helper>
                <small class="text-color-secondary">Límite actual: {{ formatFileSize(maxImageSize) }} (1MB - 50MB)</small>
            </div>

            <div>
                <label for="secondColorPrice" class="block mb-2 font-semibold">Precio por segundo color de hilado *</label>
                <p-inputgroup class="max-w-max">
                    <p-inputgroup-addon>
                        <i class="pi pi-dollar"></i>
                    </p-inputgroup-addon>
                    <p-inputnumber id="secondColorPrice" formControlName="secondColorPrice" class="w-full" placeholder="0" [min]="0" [max]="99999" [showButtons]="true"
                        buttonLayout="horizontal" spinnerMode="horizontal" [step]="100" mode="currency" currency="ARS" />
                </p-inputgroup>
                <app-error-helper [control]="priceForm.get('secondColorPrice')"></app-error-helper>
                <small class="text-color-secondary">Este precio se aplicará a todos los colores cuando se seleccione un segundo color</small>
            </div>

            <div>
                <label for="customTextPrice" class="block mb-2 font-semibold">Precio texto personalizado *</label>
                <p-inputgroup class="max-w-max">
                    <p-inputgroup-addon>
                        <i class="pi pi-dollar"></i>
                    </p-inputgroup-addon>
                    <p-inputnumber id="customTextPrice" formControlName="customTextPrice" class="w-full" placeholder="0" [min]="0" [max]="99999" [showButtons]="true"
                        buttonLayout="horizontal" spinnerMode="horizontal" [step]="100" mode="currency" currency="ARS" />
                </p-inputgroup>
                <app-error-helper [control]="priceForm.get('customTextPrice')"></app-error-helper>
                <small class="text-color-secondary">Este precio se aplicará cuando se agregue texto personalizado</small>
            </div>

            <div>
                <label for="maxTextLength" class="block mb-2 font-semibold">Longitud máxima de texto personalizado *</label>
                <p-inputgroup class="max-w-max">
                    <p-inputgroup-addon>
                        <i class="pi pi-align-left"></i>
                    </p-inputgroup-addon>
                    <p-inputnumber id="maxTextLength" formControlName="maxTextLength" class="w-full" placeholder="20" [min]="5" [max]="50" [showButtons]="true" buttonLayout="horizontal"
                        spinnerMode="horizontal" [step]="5" />
                    <p-inputgroup-addon class="pl-3 pr-3 bg-gray-100 font-semibold text-gray-600">
                        caracteres
                    </p-inputgroup-addon>
                </p-inputgroup>
                <app-error-helper [control]="priceForm.get('maxTextLength')"></app-error-helper>
                <small class="text-color-secondary">Límite actual: {{ maxTextLength }} caracteres (5 - 50)</small>
            </div>

            <div class="flex justify-content-end gap-2 mt-3">
                <p-button label="Guardar Configuración" icon="pi pi-check" (onClick)="savePrices()" [disabled]="!priceForm.valid || priceLoading" [loading]="priceLoading" />
            </div>
        </form>
    </p-card>
</div>